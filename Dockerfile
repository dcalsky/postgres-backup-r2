ARG POSTGRES_VERSION
FROM postgres:${POSTGRES_VERSION}-alpine
ARG TARGETARCH

ADD src/install.sh install.sh
RUN sh install.sh && rm install.sh

ENV POSTGRES_DATABASE=''
ENV POSTGRES_HOST=''
ENV POSTGRES_PORT=5432
ENV POSTGRES_USER=''
ENV POSTGRES_PASSWORD=''
ENV PGDUMP_EXTRA_OPTS=''
ENV CLOUDFLARE_R2_ACCESS_KEY_ID=''
ENV CLOUDFLARE_R2_SECRET_ACCESS_KEY=''
ENV CLOUDFLARE_R2_BUCKET=''
ENV CLOUDFLARE_R2_REGION='auto'
ENV R2_PREFIX='backups'
ENV CLOUDFLARE_R2_ENDPOINT=''
ENV SCHEDULE=''
ENV PASSPHRASE=''
ENV BACKUP_KEEP_DAYS=''

ADD src/run.sh run.sh
ADD src/env.sh env.sh
ADD src/backup.sh backup.sh
ADD src/restore.sh restore.sh

ENTRYPOINT ["sh", "run.sh"]
